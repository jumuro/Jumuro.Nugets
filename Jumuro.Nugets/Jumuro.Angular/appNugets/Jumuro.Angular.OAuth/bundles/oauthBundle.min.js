"use strict";function config(n,t,i){t.interceptors.push("oAuthHttpInterceptor");i.appPathName=window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/")+1);i.oAuthCookieName=("AppInfo_"+window.location.host+i.appPathName).replace(/[:\/]/g,"_")}function oAuthHttpInterceptor(n,t,i,r){var u={},f=function(n){var u,f;return n.headers=n.headers||{},u=i(r.oAuthCookieName),u?n.headers.Authorization="Bearer "+u.access_token:(f=t.get("oAuthService"),f.logOut()),n},e=function(u){var o;if(u.status===401){var s=t.get("oAuthService"),h=i(r.oAuthCookieName),f=f||t.get("$http"),e=n.defer();return h&&s.refreshToken().then(function(){return e.resolve(f(u.config))}),e.promise}if(u.status===403)o=t.get("toaster"),o.pop("error","Access Denied","You are not authorized to do this request.");else return n.reject(u)};return u.request=f,u.responseError=e,u}function oAuthService(n,t,i,r,u){var e=function(){for(var e,o,c,s=JSON.parse(localStorage.getItem("apiUrlList")),h="",i=0;i<s.length;i++)if(s[i].UrlName=="OAuthURL"){h=s[i].UrlValue;break}return e=t.defer(),o=r(u.oAuthCookieName),o&&(c="grant_type=refresh_token&refresh_token="+o.refresh_token+"&client_id="+o.client_id,n.post(h,c,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(n){r(u.oAuthCookieName,n,{path:u.appPathName});e.resolve(n)}).error(function(n){f();e.reject(n)})),e.promise},f=function(){r.remove(u.oAuthCookieName,{path:u.appPathName});var n=i.get("toaster");n.pop("error","Cookie error","Authorization info not found. Trying to authorize again...");window.location.href=u.appPathName};return{refreshToken:function(){return e()},logOut:function(){return f()}}}angular.module("espa.publicOAuth",["espa.notificationChannel","ipCookie","toaster"]).config(config);config.$inject=["$routeProvider","$httpProvider","oAuthConstants"];angular.module("espa.publicOAuth").constant("oAuthConstants",{oAuthCookieName:"",appPathName:""});angular.module("espa.publicOAuth").factory("oAuthHttpInterceptor",oAuthHttpInterceptor);oAuthHttpInterceptor.$inject=["$q","$injector","ipCookie","oAuthConstants"];angular.module("espa.publicOAuth").service("oAuthService",oAuthService);oAuthService.$inject=["$http","$q","$injector","ipCookie","oAuthConstants"];
/*
//# sourceMappingURL=oauthBundle.min.js.map
*/